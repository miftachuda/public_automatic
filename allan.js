var _0x4f9e15=_0x20e6;(function(_0x62c88b,_0xd157fc){var _0x2f7179=_0x20e6,_0x51093d=_0x62c88b();while(!![]){try{var _0x5570b5=parseInt(_0x2f7179(0xf6))/0x1+parseInt(_0x2f7179(0xd1))/0x2+parseInt(_0x2f7179(0x11c))/0x3+parseInt(_0x2f7179(0x114))/0x4+parseInt(_0x2f7179(0x101))/0x5+parseInt(_0x2f7179(0xc8))/0x6*(-parseInt(_0x2f7179(0xf2))/0x7)+-parseInt(_0x2f7179(0xe5))/0x8;if(_0x5570b5===_0xd157fc)break;else _0x51093d['push'](_0x51093d['shift']());}catch(_0x2220fb){_0x51093d['push'](_0x51093d['shift']());}}}(_0x8988,0x42889));const fs=require('fs/promises'),lodash=require(_0x4f9e15(0x129)),moment=require(_0x4f9e15(0xa8)),axios=require(_0x4f9e15(0x128)),qs=require('qs');require('colors');var lastvalue,schedule,scannerarr=['muhammad.rovalino','satrio.sarjono','miftachul.huda'],unit=[_0x4f9e15(0xf1),_0x4f9e15(0xd7),_0x4f9e15(0xbe),_0x4f9e15(0xc5),_0x4f9e15(0xb9),'041'],username=_0x4f9e15(0x10e),password=_0x4f9e15(0x124);const listshift=[[_0x4f9e15(0x113),_0x4f9e15(0x109),_0x4f9e15(0x115),_0x4f9e15(0x9f)],['A2\x20Malam',_0x4f9e15(0xbb),'D1\x20Sore',_0x4f9e15(0x123)],['A3\x20Malam',_0x4f9e15(0x10d),'D2\x20Sore','B\x20Off\x20Pagi'],['B1\x20Malam',_0x4f9e15(0xe8),_0x4f9e15(0xdb),_0x4f9e15(0x108)],[_0x4f9e15(0xa9),_0x4f9e15(0xab),_0x4f9e15(0x106),_0x4f9e15(0xea)],[_0x4f9e15(0xc4),_0x4f9e15(0xd2),_0x4f9e15(0xa4),_0x4f9e15(0x11a)],['C1\x20Malam','D2\x20Pagi',_0x4f9e15(0x12c),_0x4f9e15(0x11e)],[_0x4f9e15(0x125),_0x4f9e15(0x127),_0x4f9e15(0xd0),_0x4f9e15(0x110)],[_0x4f9e15(0xc6),_0x4f9e15(0xed),'B2\x20Sore',_0x4f9e15(0xdc)],[_0x4f9e15(0xec),_0x4f9e15(0xaa),_0x4f9e15(0x10a),_0x4f9e15(0xb0)],[_0x4f9e15(0x11b),_0x4f9e15(0xc1),_0x4f9e15(0xd9),'B\x20Off\x20Sore'],['D3\x20Malam',_0x4f9e15(0xbc),'C2\x20Sore','A\x20Off\x20Pagi']];function getPeriod(_0x1ef248){if(_0x1ef248<0x1e0)return 0x0;return _0x1ef248<0x3c0?0x1:0x2;}function checkShift(){var _0x1ae9df=_0x4f9e15,_0x25964d=moment(new Date()),_0x543f92=moment(_0x1ae9df(0xe7)),_0x2164ed=moment[_0x1ae9df(0xe4)](_0x25964d[_0x1ae9df(0xb3)](_0x543f92)),_0x5a4300=Math[_0x1ae9df(0x111)](_0x2164ed['asDays']())%0xc,_0x46ba68=Math['trunc'](_0x2164ed['asMinutes']())%0x5a0;return listshift[_0x5a4300][getPeriod(_0x46ba68)];}function checkShiftPeriod(){var _0x12c772=_0x4f9e15,_0x1f55f6=moment()['hours']();if(_0x1f55f6<0x4)return _0x12c772(0xcc);else{if(_0x1f55f6<0x8)return _0x12c772(0xff);else{if(_0x1f55f6<0xc)return _0x12c772(0xdd);else{if(_0x1f55f6<0x10)return'12:00';else{if(_0x1f55f6<0x14)return _0x12c772(0xca);else return _0x12c772(0xf3);}}}}}function _0x20e6(_0x4219f3,_0x2df77e){var _0x89886d=_0x8988();return _0x20e6=function(_0x20e606,_0x2e7056){_0x20e606=_0x20e606-0x9e;var _0x1bf1e5=_0x89886d[_0x20e606];return _0x1bf1e5;},_0x20e6(_0x4219f3,_0x2df77e);}async function callAxiosWithRetry(_0x425d17,_0x2bbea0,_0x345c37){var _0x5706eb=_0x4f9e15;const _0x59e58b=_0xd22cba=>new Promise(_0x1f053b=>setTimeout(_0x1f053b,_0xd22cba));try{return await axios(_0x425d17);}catch(_0x34da39){if(_0x2bbea0>0x14)throw _0x34da39;return console['log'](_0x345c37[_0x5706eb(0xaf)]),await _0x59e58b(0x2**_0x2bbea0*0x64),console[_0x5706eb(0xee)](_0x5706eb(0x105)['green']+_0x2bbea0),callAxiosWithRetry(_0x425d17,_0x2bbea0+0x1,_0x345c37);}}async function requireF(_0x33e595,_0x1a7879,_0x3d3fd2){var _0x5a3c06=_0x4f9e15;try{return state=!![],require(_0x33e595);}catch(_0x13a412){return console['log'](_0x1a7879[_0x5a3c06(0xaf)]),await _0x3d3fd2(),state=![],![];}}async function fire(_0x352fa2,_0x4dd51d){var _0x24483c=async function(){var _0x5ac3a1=_0x20e6,_0x2b3780=qs['stringify']({'username':_0x352fa2,'password':_0x4dd51d,'companyCode':_0x5ac3a1(0xf4),'domainName':_0x5ac3a1(0x122)}),_0x2a0e5a={'method':'post','url':_0x5ac3a1(0x120),'headers':{'Content-Type':'application/x-www-form-urlencoded'},'data':_0x2b3780};return console[_0x5ac3a1(0xee)](_0x5ac3a1(0xe1)),callAxiosWithRetry(_0x2a0e5a,0x0,_0x5ac3a1(0xf8))[_0x5ac3a1(0xfa)](function(_0x4f2bcc){var _0x16cfc9=_0x5ac3a1;return console['log'](_0x16cfc9(0xa6)[_0x16cfc9(0xa0)]),_0x4f2bcc[_0x16cfc9(0xc0)][_0x16cfc9(0xf5)];});},_0xf66e82=async function(_0x36d22f){var _0x285c45=_0x20e6,_0x52e3c8={'method':_0x285c45(0xf0),'url':_0x285c45(0xf9),'headers':{'Authorization':_0x285c45(0xb5)+_0x36d22f}};return console['log'](_0x285c45(0xa3)),callAxiosWithRetry(_0x52e3c8,0x0,_0x285c45(0x11d))['then'](function(_0x598b04){var _0x4f0e7d=_0x285c45;return console['log']('Sucessfully\x20Get\x20Last\x20Value\x20From\x20Server'[_0x4f0e7d(0xa0)]),_0x598b04[_0x4f0e7d(0xc0)];});},_0x555474=async function(_0x1b8243){var _0x4e05d0=_0x20e6,_0x8ff39={'method':_0x4e05d0(0xf0),'url':'https://apps.pertamina.com/bocpp-v2.0/api/scheduleHistories?ru=R401&area=LOC-II','headers':{'Authorization':'Bearer\x20'+_0x1b8243}};return console[_0x4e05d0(0xee)]('Request\x20Schedule\x20History,\x20Please\x20Wait....'),callAxiosWithRetry(_0x8ff39,0x0,_0x4e05d0(0xb6))[_0x4e05d0(0xfa)](function(_0x2ee34a){var _0x45f6df=_0x4e05d0;return console['log'](_0x45f6df(0xfb)[_0x45f6df(0xa0)]),_0x2ee34a[_0x45f6df(0xc0)];});};let _0x8e47b2=!![];const _0x20f514=await _0x24483c();return await async function _0x879d7a(){var _0x56c3c8=_0x20e6;lastvalue=await _0xf66e82(_0x20f514)[_0x56c3c8(0xfa)](_0x465bfc=>_0x465bfc)[_0x56c3c8(0xef)](()=>{var _0x7617b4=_0x56c3c8;return console['log'](_0x7617b4(0xba)[_0x7617b4(0x11f)]),requireF(_0x7617b4(0xbd),'Last\x20value\x20not\x20available\x20in\x20the\x20Disk',_0x879d7a);}),fs[_0x56c3c8(0xd8)](_0x56c3c8(0xe3),JSON[_0x56c3c8(0xeb)](lastvalue)),schedule=await _0x555474(_0x20f514)[_0x56c3c8(0xfa)](_0x4c5b50=>_0x4c5b50)[_0x56c3c8(0xef)](()=>{var _0x4972c2=_0x56c3c8;return console[_0x4972c2(0xee)](_0x4972c2(0x107)[_0x4972c2(0x11f)]),requireF(_0x4972c2(0x112),_0x4972c2(0xcd));}),fs[_0x56c3c8(0xd8)](_0x56c3c8(0xae),JSON[_0x56c3c8(0xeb)](schedule));}(),[_0x8e47b2,_0x20f514];}var filtering=function(_0x3ab135,_0x41316d,_0x384697,_0xde0aaf,_0x49e03d){var _0x1bb051=_0x4f9e15;if(_0x3ab135)var _0x15a533=lodash(schedule)[_0x1bb051(0xc3)]({'unit':_0x41316d,'shift':_0x384697,'status':_0x1bb051(0xa1)})['value'](),_0x465b8e=_0x15a533[_0x1bb051(0xc3)](function(_0x18e9b1){var _0x75ddb9=_0x1bb051;if(_0x18e9b1['equipment'][_0x75ddb9(0x102)](0x0,0x4)=='041T'||_0x18e9b1['equipment'][_0x75ddb9(0x102)](0x0,0x4)==_0x75ddb9(0xe6))return![];else return!![];}),_0x1a9182=_0x465b8e[_0x1bb051(0xfc)](_0x3a0247=>{var _0x329050=_0x1bb051;function _0x579585(){function _0x54d8f9(_0x53e80d,_0xc233eb){var _0x481250=_0x20e6;return Math[_0x481250(0xb7)](Math[_0x481250(0x117)]()*(_0xc233eb-_0x53e80d+0x1)+_0x53e80d);}return random=_0x54d8f9(0x27,0x78),random;}_0x49e03d=moment(_0x49e03d);function _0x46d9cd(_0x70aa3d,_0x340506){return _0x70aa3d+_0x340506*0x3e8;}var _0x1e7d43=lodash(lastvalue)[_0x329050(0xc3)]({'idEquipment':_0x3a0247['idEquipment']})[_0x329050(0xb2)](),_0x22165b=Object['keys'](_0x1e7d43)[_0x329050(0xac)](function(_0x48caa8,_0xa0df8c){var _0x290ccf=_0x329050;return _0x48caa8[_0x290ccf(0xe0)](_0x1e7d43[_0xa0df8c]);},[]),_0xb296bf=_0x46d9cd(_0x49e03d,_0x579585()),_0x1db6c9=moment(_0xb296bf)[_0x329050(0xad)](_0x329050(0x119))['toString'](),_0x243b41=moment(_0xb296bf)[_0x329050(0xad)](_0x329050(0xc9))[_0x329050(0xfe)]();return _0x49e03d=_0xb296bf,_0x22165b['map'](_0x13bf70=>{var _0x11e4ff=_0x329050;return{'idScheduleHistory':_0x3a0247['id'],'parentRecord':_0x3a0247['parentRecord'],'value':_0x13bf70['value'],'idParameter':_0x13bf70[_0x11e4ff(0x9e)],'scanWith':_0x11e4ff(0xe2),'timestamp':_0x1db6c9,'scanBy':_0xde0aaf,'approved':0x0,'shift':_0x243b41,'notesRecord':''};});}),_0xe1e2ab=Object[_0x1bb051(0xb1)](_0x1a9182)[_0x1bb051(0xac)](function(_0xb8bf90,_0x5ac430){return _0xb8bf90['concat'](_0x1a9182[_0x5ac430]);},[]);else _0xe1e2ab=null;return[_0xe1e2ab,_0x465b8e];},syncronize=async function(_0xe3b3d2,_0x5857c6,_0x5612c5,_0x199ab9){var _0x3d55b4=_0x4f9e15,_0x5d58c2=JSON[_0x3d55b4(0xeb)](_0xe3b3d2),_0x45b2d0={'method':_0x3d55b4(0x12b),'url':_0x3d55b4(0x118),'headers':{'Authorization':'Bearer\x20'+_0x5857c6,'Content-Type':_0x3d55b4(0x104)},'data':_0x5d58c2};return console[_0x3d55b4(0xee)](_0x3d55b4(0xda)),callAxiosWithRetry(_0x45b2d0,0x0,_0x3d55b4(0x126)+_0x5612c5+'\x20time\x20'+_0x199ab9+_0x3d55b4(0xfd))['then'](function(_0x217e3b){var _0x11d970=_0x3d55b4;return console['log'](_0x11d970(0x116)[_0x11d970(0xa0)]),_0x217e3b[_0x11d970(0xc0)][0x0][_0x11d970(0xd4)];});};async function sendMessage(_0x3da6e6){var _0x4d40a0=_0x4f9e15;let _0xc59bbe=encodeURIComponent(_0x3da6e6);var _0x314682={'method':_0x4d40a0(0x12b),'url':_0x4d40a0(0xdf)+_0xc59bbe,'headers':{}};await axios(_0x314682)[_0x4d40a0(0xfa)](function(_0x1b7de5){var _0x4a0632=_0x4d40a0;console[_0x4a0632(0xee)]('Telegram\x20message\x20Sent');})[_0x4d40a0(0xef)](function(_0x19541c){var _0x2fed34=_0x4d40a0;console[_0x2fed34(0xee)]('Failed\x20sending\x20Telegram\x20message'),console['log'](_0x19541c);});}var uploadscene=async function(_0x4b2941,_0x221718,_0x35e0dc,_0x386fea,_0x1b27a7,_0x163689){var _0x2c4ae8=_0x4f9e15,_0x563029=filtering(_0x4b2941,_0x221718,_0x35e0dc,_0x386fea,_0x1b27a7);_0x563029[0x1]!=null&&_0x563029[0x0]!=null?await syncronize(_0x563029[0x0],_0x163689,_0x221718,_0x35e0dc)['then'](async _0x4e5818=>{var _0x14cd0d=_0x20e6;console[_0x14cd0d(0xee)](_0x14cd0d(0x126)+Object['keys'](_0x563029[0x1])[_0x14cd0d(0xb8)]+_0x14cd0d(0x10f)+_0x221718+_0x14cd0d(0xa5)+_0x35e0dc+_0x14cd0d(0xa7)+_0x563029[0x0][_0x563029[0x0][_0x14cd0d(0xb8)]-0x1]['timestamp'][_0x14cd0d(0xe9)]+_0x14cd0d(0xbf)+_0x386fea+'\x20Messages\x20:\x20'+_0x4e5818[_0x14cd0d(0xe9)]),await sendMessage(_0x14cd0d(0xa2)+_0x386fea+'</b>\x20Unit\x20<b>'+_0x221718+'</b>\x20'+Object['keys'](_0x563029[0x1])[_0x14cd0d(0xb8)]+_0x14cd0d(0xf7)+_0x35e0dc+_0x14cd0d(0xa7)+_0x563029[0x0][_0x563029[0x0][_0x14cd0d(0xb8)]-0x1]['timestamp']+_0x14cd0d(0xcf)+_0x4e5818+']');})[_0x2c4ae8(0xef)](()=>{var _0x3da08e=_0x2c4ae8;console[_0x3da08e(0xee)](_0x3da08e(0xd6));}):(console[_0x2c4ae8(0xee)](_0x2c4ae8(0xce)[_0x2c4ae8(0xaf)]),await sendMessage(_0x2c4ae8(0xc7)));};async function asyncForEach(_0x5e3743,_0x3d3951){var _0x4dcd05=_0x4f9e15;for(let _0xeced64=0x0;_0xeced64<_0x5e3743[_0x4dcd05(0xb8)];_0xeced64++){await _0x3d3951(_0x5e3743[_0xeced64],_0xeced64,_0x5e3743);}}const proceed=async function(_0x7174d){var _0x3c728a=_0x4f9e15,_0x5bf30f=moment()[_0x3c728a(0xad)]('YYYY-MM-DD')[_0x3c728a(0xfe)](),_0x2d07dd=checkShiftPeriod(),_0x31fc62=await fire(_0x7174d['username'],_0x7174d['password']);function _0x5b25f2(){function _0x4c0a78(_0x3ada0e,_0x19c6e7){var _0x3836ac=_0x20e6;return Math[_0x3836ac(0xb7)](Math['random']()*(_0x19c6e7-_0x3ada0e+0x1)+_0x3ada0e);}return random=_0x4c0a78(0x384,0x6a4),random;}function _0x1abbd7(_0x49101b){var _0x426536=_0x3c728a;return moment(_0x5bf30f+'\x20'+_0x49101b)[_0x426536(0xc2)](_0x5b25f2(),_0x426536(0x10b))[_0x426536(0xad)]('YYYY-MM-DD\x20HH:mm:ss')[_0x426536(0xfe)]();}var _0x3e6448=_0x1abbd7(_0x2d07dd);await asyncForEach(_0x7174d[_0x3c728a(0xd3)],async _0x28950c=>{await asyncForEach(_0x28950c[0x1],async _0x3d720f=>{var _0x2f65d3=_0x20e6;console[_0x2f65d3(0xee)](_0x31fc62[0x0],_0x3d720f,_0x2d07dd,_0x28950c[0x0],_0x3e6448,_0x31fc62[0x1]),await uploadscene(_0x31fc62[0x0],_0x3d720f,_0x2d07dd,_0x28950c[0x0],_0x3e6448,_0x31fc62[0x1]);});});};function _0x8988(){var _0xd6d8b5=['Retrying\x20..\x20','A1\x20Sore','Failed\x20Get\x20Schedule\x20From\x20Server.\x20Trying\x20to\x20Get\x20From\x20Disk','A\x20Off\x20Malam','B2\x20Pagi','B3\x20Sore','seconds','no\x20kuota','C1\x20Pagi','miftachul.huda','\x20Equip\x20Record\x20Unit\x20','A\x20Off\x20Sore','trunc','./schedule.json','A1\x20Malam','1220888MUbVQC','C3\x20Sore','Sucessfully\x20Sending\x20Records','random','https://apps.pertamina.com/bocpp-v2.0/api/equipRecords/','YYYY-MM-DD\x20HH:mm:ss','C\x20Off\x20Pagi','D2\x20Malam','1253403iSBjOd','Failed\x20to\x20get\x20Last\x20Value\x20Record','B\x20Off\x20Malam','bgYellow','https://apps.pertamina.com/bocpp-v2.0/api/logins?secretKey=ee8fbc9dfa034db4a2419bfb4bfa9562','err','pertamina','C\x20Off\x20Sore','asyncFunti0n11','C2\x20Malam','Upload\x20','D3\x20Pagi','axios','lodash','./lastscan.json','post','A3\x20Sore','idParameter','D\x20Off\x20Malam','green','Running','<b>','Request\x20Last\x20Value,\x20Please\x20Wait....','A2\x20Sore','\x20jam\x20','Sucessfully\x20Login\x20to\x20server','\x20date\x20','moment','B2\x20Malam','A2\x20Pagi','C3\x20Pagi','reduce','format','schedule.json','red','C\x20Off\x20Malam','keys','value','diff','now','Bearer\x20','Failed\x20to\x20Get\x20Schedule\x20History','floor','length','025','Failed\x20Get\x20Last\x20Value\x20From\x20Server.\x20Trying\x20to\x20Get\x20From\x20Disk','B3\x20Pagi','B1\x20Pagi','./lastvalue.json','023','\x20user\x20','data','A3\x20Pagi','add','filter','B3\x20Malam','024','C3\x20Malam','No\x20records\x20available\x20to\x20send','6EniRyT','HH:mm:ss','16:00','allan.syahputra','00:00','Schedule\x20not\x20available\x20in\x20the\x20Disk','Data\x20not\x20available','\x20:[','B1\x20Sore','1010600ULkzrh','D1\x20Pagi','unit','Message','date','failed\x20upload\x20record','022','writeFile','C1\x20Sore','Uploading\x20Record\x20Data...','D3\x20Sore','D\x20Off\x20Pagi','08:00','lastscan.json','https://api.telegram.org/bot5266529032:AAG6oq2TOmKOXrt5qaeVLk3ehvYF0bJZ6ko/sendMessage?chat_id=-575255072&parse_mode=HTML&text=','concat','Send\x20Login\x20key....','rfid','lastvalue.json','duration','8207120vtpOsr','TAPP','2021-12-22','C2\x20Pagi','blue','D\x20Off\x20Sore','stringify','D1\x20Malam','A1\x20Pagi','log','catch','get','021','2499770HmqMHE','20:00','1010','token','9570gKVNTY','\x20Equip\x20Record\x20','Failed\x20to\x20Login\x20Something\x20Wrong','https://apps.pertamina.com/bocpp-v2.0/api/lastValueRecords?bocpp=boc&ru=R401&area=LOC-II','then','Sucessfully\x20Get\x20Schedule\x20History\x20From\x20Server','map','\x20Failed','toString','04:00','Pertamina#ru4','2088140eYUwpJ','substring','minutes','application/json'];_0x8988=function(){return _0xd6d8b5;};return _0x8988();}var runit=async function(){var _0x4b9c8a=_0x4f9e15,_0x315412={'date':Date[_0x4b9c8a(0xb4)]()},_0x1e8561=await requireF(_0x4b9c8a(0x12a),'not\x20available',()=>{var _0x7e16bb=_0x4b9c8a;console[_0x7e16bb(0xee)](_0x7e16bb(0x121));}),_0x26bb85=moment(_0x1e8561[_0x4b9c8a(0xd5)]),_0x52b207=moment()[_0x4b9c8a(0xb3)](_0x26bb85,_0x4b9c8a(0x103),!![]);if(_0x52b207>0x8*0x3c){var _0x3dc182=checkShift();switch(_0x3dc182[0x0]){case'A':break;case'B':proceed({'username':_0x4b9c8a(0xcb),'password':_0x4b9c8a(0x100),'unit':[[_0x4b9c8a(0xcb),[_0x4b9c8a(0xc5)]]]})['then'](()=>{var _0x86859f=_0x4b9c8a;fs[_0x86859f(0xd8)](_0x86859f(0xde),JSON[_0x86859f(0xeb)](_0x315412));});break;case'C':break;case'D':break;default:console[_0x4b9c8a(0xee)]('Error\x20no\x20shift\x20match');break;}}else console['log'](_0x4b9c8a(0x10c));};runit();
